<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Activity Logs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-btn.active { border-bottom: 3px solid #3b82f6; color: #3b82f6; font-weight: bold; }
        .tab-btn { transition: all 0.2s; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans min-h-screen p-4">

    <header class="max-w-4xl mx-auto flex justify-between items-center mb-8 p-4 bg-gray-800 rounded-2xl shadow-lg">
        <h1 class="text-2xl font-black text-blue-400 italic cursor-pointer" onclick="location.href='/'">WEB TOOLS LOGS</h1>
        <button onclick="location.href='/'" class="bg-gray-700 text-white px-4 py-2 rounded-xl text-sm font-bold hover:bg-gray-600 transition">메인으로</button>
    </header>

    <div class="max-w-4xl mx-auto bg-gray-800 rounded-2xl shadow-2xl border border-gray-700 overflow-hidden">
        <div class="flex border-b border-gray-700 bg-gray-850 text-xs sm:text-sm">
            <button onclick="changeTab('download')" id="tab-download" class="tab-btn active flex-1 py-4 text-center hover:bg-gray-750">
                1. 다운로드 기록
            </button>
            <button onclick="changeTab('convert')" id="tab-convert" class="tab-btn flex-1 py-4 text-center hover:bg-gray-750">
                2. SRT 변환 기록
            </button>
            <button onclick="changeTab('merge')" id="tab-merge" class="tab-btn flex-1 py-4 text-center hover:bg-gray-750">
                3. 자막 합치기 기록
            </button>
        </div>

        <div class="overflow-x-auto min-h-[400px]">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-gray-900 text-gray-400 text-[10px] uppercase">
                        <th class="p-4 border-b border-gray-700 w-[180px]">일시</th>
                        <th class="p-4 border-b border-gray-700 w-[120px]">IP</th>
                        <th class="p-4 border-b border-gray-700">상세 내역</th>
                    </tr>
                </thead>
                <tbody id="log-table-body" class="text-xs sm:text-sm">
                    <tr><td colspan="3" class="p-10 text-center text-gray-500">데이터를 불러오는 중...</td></tr>
                </tbody>
            </table>
        </div>
        
        <div class="p-4 bg-gray-900 border-t border-gray-700 text-right">
            <button onclick="loadLogs()" class="text-xs text-blue-400 hover:underline">데이터 새로고침</button>
        </div>
    </div>

    <script>
        let allLogs = [];
        let currentTab = 'download';

        async function loadLogs() {
            try {
                const res = await fetch('/api/admin/logs');
                if(!res.ok) throw new Error("Unauthorized");
                allLogs = await res.json();
                renderLogs();
            } catch (e) {
                document.getElementById('log-table-body').innerHTML = 
                    '<tr><td colspan="3" class="p-10 text-center text-red-400 font-bold">로그를 불러오는데 실패했습니다. (DB 테이블 또는 관리자 권한 확인)</td></tr>';
            }
        }

        function changeTab(tabName) {
            currentTab = tabName;
            ['download', 'convert', 'merge'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                if(t === tabName) btn.classList.add('active');
                else btn.classList.remove('active');
            });
            renderLogs();
        }

        function renderLogs() {
            const tbody = document.getElementById('log-table-body');
            tbody.innerHTML = '';
            const filtered = allLogs.filter(log => log.action_type === currentTab);

            if(filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="p-10 text-center text-gray-500">기록된 로그가 없습니다.</td></tr>';
                return;
            }

            filtered.forEach(log => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-750 border-b border-gray-700 transition";
                tr.innerHTML = `
                    <td class="p-4 text-gray-400 whitespace-nowrap font-mono">${log.created_at}</td>
                    <td class="p-4 font-mono text-gray-500">${log.ip_address}</td>
                    <td class="p-4 text-gray-300 break-all">${log.details}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        loadLogs();
    </script>
</body>
</html>